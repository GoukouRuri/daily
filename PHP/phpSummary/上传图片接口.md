### 基本处理方案

```php
<?php

function upload()
{
    $file = $_FILES['file'];//得到上传过来的数据
    $size = $_POST['img_size'] ? $_POST['img_size'] : 0;//图片大小限制
    $width = $_POST['img_width'] ? $_POST['img_width'] : 0;//图片宽度限制
    $height = $_POST['img_height'] ? $_POST['img_height'] : 0;//图片高度限制
    
    if ($file['size'] > $size) {
        $this->message($code = -1, '上传信息错误！');
    }
    
    if (empty($file) || $file['error']) {
        $this->message($code = -1, '图片大小超出上传限制！');
    }
    
    
    $type = strtolower(substr($file['name'], strrpos($file['name'], '.')+1));//得到文件类型，并且都转化成小写
    $allow_type = array('jpg','jpeg','gif','png'); //定义允许上传的类型
    //判断文件类型是否被允许上传
    if (!in_array($type, $allow_type)) {
        //如果不被允许，则直接停止程序运行
        $this->message($code=-1, '图片格式错误！');
    }
    
    $date = date("Y-m-d",time());
    $path = "./public/images/admin/file/".$date."/"; 
    if (!file_exists($path)) {
        mkdir($path, 0777, true);
    }
    $path = substr($path, 1); // 去掉前面的.
    $picName = uniqid().".".$type;
    $upload_path = $_SERVER['DOCUMENT_ROOT'] . $path . $picName;  //上传文件的存放路径
    
    //将图片从临时地址移到图片存储地址
    try {
         if (move_uploaded_file($file['tmp_name'], $upload_path)) {
             $pic = $path.$picName;
             header('Content-type: application/json'); //必须加
             $this->message($code=1, $pic);
         } else {
             $this->message($code=-1,'图片上传失败！');
         }
    } catch (\Exception $e) {
        $this->message($code=-1, $e->getMessage());
    }
    
    
}

```
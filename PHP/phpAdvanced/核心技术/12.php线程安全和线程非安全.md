### 在PHP中,线程安全或非线程安全是什么？
  - 参考https://stackoverflow.com/questions/1623914/what-is-thread-safe-or-non-thread-safe-in-php
  
* php非安全版本:fts, php安全版本ts

  - 对于同一段代码,TS版本永远不会比NTS更快.
  这很明显,因为TS需要做额外的工作来确保它是TS,会出现更多的错误机会,需要解决内存泄漏和碎片处理等问题
  - 线程安全版本不是必要的,不建议在多线程中使用php,也不用使用,对于apache,php是作为模块加载的,你使用Apache的prefork MPM不使用线程,因此,PHP线程安全并不重要.
    
    对于nginx或者lighttpd,你将无法将PHP嵌入到它们中.
    你将会看到使用FastCGI或者其他一些PHP完全不在外的模型用于通过例如FastCGI应答请求的多个PHP进程的Web服务器.
    对于这种情况,线程安全也无关紧要.
    
    
  - 线程安全意味着二进制文件可以在多线程的web服务器上下文中运行,例如Windows上的Apache2. 线程安全通过在每个线程中创建本地存储副本来工作,以便数据不会与另一个线程冲突.
    
    那么我选择什么？如果您选择将PHP作为CGI二进制文件运行,那么您将不需要线程安全性,因为二进制文件在每个请求时都会被调用.
    而对于多线程的Web服务器,例如IIS5和IIS6,应该使用PHP的线程版本

    除此之外许多库时不支持多线程环境中使用的,如SNMP（Unix）,mSQL（Unix）,IMAP（Win / Unix）,Sybase-CT（Linux,libc5）
    
* [Swoole](https://www.swoole.com/)：面向生产环境的 PHP 异步网络通信引擎
  - swoole支持多线程模式的建议探讨
    - php有一个多线程的扩展 [pthreads](php.net/manual/zh/book.pthreads.php),pthreads 实现多线程的原理很巧妙并且避免了php自身对多线程处理的短板,而且是线程安全的,它提供了一个 Threaded 的基础类,这个类实现了一个迭代器的功能.
    当使用pthreads进行多线程编程时,被创建的线程只有 Threaded 对象的变量是线程间相互共享的,其它变量都是隔离的.
    
    目前swoole用多进程方式有自己的优点,但是实际开发中通过task进行投递也是有很多短板的,比如：数据不能实现共享（虽然提供了 swoole_table 但是这个对象不够灵活,且只能start前预先构造好,后续不能扩展和变动）,投递任务必须要等到被投递进程是空闲的时候才会处理等等。
    
    如果swoole使用 pthreads 一样的特性,启动 worker 和 taskWorker 时使用线程复制出n个后,程序编程时可对特定对象（类似 Threaded 迭代器） 数据进行操作并且能够实现线程间数据同步那么就完美了,这样很多数据的传递就不需要通过task去投递了。
    
  - 多线程并没有多进程稳定可靠,有更多的问题, 可以task,消息队列等功能实现,又没这么多坑
    
    - 关于task:在php中使用协程实现多任务调度http://www.laruence.com/2015/05/28/3038.html
    - 消息队列:https://www.zhihu.com/question/33200763
    
      - 小型：redis, SPL队列SplQueue等
      - 大型：rabbitmq, Beanstalk等
      - 为什么使用消息队列https://segmentfault.com/q/1010000005780973
        
      










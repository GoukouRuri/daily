> ### linux下应该注意的事项

* linux严格区分大小写

* linux所以内容都是以文件形式保存的，包括硬件也是。。所以用命令行更改的配置项只是临时生效，重启即失效，需要在配置文件中更改才能永久生效

* linux不靠扩展名识别文件，即使不写扩展名，依然识别，比如.sh,.conf,.gz,甚至程序文件.php,.html等,但是受权限控制,所以windows的执行文件压根不识别也没权限执行(即使是木马病毒也需要权限执行才行),但有例外比如程序文件和压缩包文件等在两种系统下都识别,但linux下依然受权限控制

* linux下所以设备都需要挂载后才能使用,包括硬盘，光盘，u盘。

* 远程服务器建议不要关机，只能重启,否则只能电源开机。。重启服务器时应该关闭服务甚至网络服务，因为个人机可能没事，但是正式的服务器工作时进行大量数据出来，突然关机重启会影响设备，甚至损坏设备，烧坏硬盘。。

* 不要在服务器访问高峰期运行高负载命令(全盘扫描，大数据压缩，复制，扫描，备份等),否则影响性能，甚至损坏设备

* 远程配置防火墙时不要把自己踢出服务器

* 合理分配权限

* 定期备份重要数据和日志，十分重要，需要备份多份！

> ### linux各目录的组成

* /bin/  存放命令的目录，root用户和普通用户均可以使用，单用户模式下(类似使用winpe或者windows安全模式进行修复时)也可以

* /sbin/ 存放命令和环境设置相关命令的目录，只有root用户可以使用，但有些命令普通用户可以查看

* /usr/bin/ 存放命令的目录，root用户和普通用户均可以使用，但是单用户模式下不可以使用

* /usr/sbin/ 存放命令的目录，只有root用户可以使用

* /boot/   系统启动资源的目录，启动相关的文件(一般分配的很少，尽量不要在这里面写文件，满了系统启不来)，建议系统备份

* /dev/ 设备文件保存目录

* /etc/  linux默认的存放绝大多数配置文件的目录,系统内所有采用默认安装方式（rpm安装）的服务配置文件全部保存在这里,如用户名，密码，服务启动脚本，常见服务的配置文件等, 建议系统备份

* /root/ root用户家目录

* /home/ 普通用户的家目录

* /lib/  存放系统调用的函数库的目录

* /lost+found  系统崩溃或者意外断电时存放文件碎片的目录,平时什么都没有,fsck工具修复系统时会检查这里

* /media/ 挂载媒体设备的目录,如软盘和光盘

* /mnt/ 挂载目录，没有细分，都可以挂载，建议挂载u盘，硬盘或者其他操作系统的分区

* /misc/ 挂载NFS服务的共享目录

* /opt/ 第三方安装的软件的存放目录，但是现在的流行趋势一般都安装在/usr/local目录下，这个目录很少用来装软件了

* /proc/ 和 /sys/  虚拟文件系统,都是保存在内核中的，所以千万不能在里面写或者存放文件，因为重启就会被重置或者把内存占满导致死机

* /src/ 服务数据目录, 可以保存需要的数据

* /tmp/ 临时目录

* /usr/ 系统资源目录，unix software resource 缩写,不是保存用户数据，而是存放系统资源的目录，大多数软件保存在这里， 建议系统备份

* /var/ 动态数据保存位置（如日志,邮件等）

> ### linux的常用命令

* 目录处理命令
  - ls

    -a 显示所有文件,包括隐藏文件

    -l 显示详细信息（ls -lh 显示的文件大小可以人性化显示）

    -d 查看目录属性

    -i 显示文件节点(每个文件都有一个节点，但一个节点可以对应多个文件，硬链接的文件与源文件有相同的节点)

  - mkdir

    -p 递归创建目录

  - pwd 显示当前目录

  - cd 切换目录

  - cp

    -r 可以复制目录

    -p 保留文件属性(备份日志时不希望文件更新时间发生改变)

  - mv 移动文件

  - rm

    -r 可以删除目录

    -f 强制执行

* 文件处理命令

  - touch 创建一个空文件(如果创建带空格名文件时用双引号引起来)

  - cat
    -n 显示文件内容(带行号)

  - tac 倒着显示文件内容

  - more 分页显示文件内容

     空格或者f 翻页
     enter 换行
     q 退出

  -  less 和more一样,但是可以上翻页

     / 搜索内容 n 继续查找

  - head -n 查看文件前几行

  - tail

    -n (指定行数) 查看文件末尾几行

    -f 动态显示文件末尾内容(比如看动态日志)

* 链接命令

  - ln -s [源文件] [目标文件] 生成软链接

  - ln [源文件] [目标文件]    

  硬链接: 同步更新，一个丢失对另一个不影响

  软链接: 相当于快捷方式,指向源文件, 权限是lrwxrwxrwx

* 权限管理命令(文件权限更改只能是文件所有者或者root)

  - chmod

    chmod [ugoa][+-=][rwx] 文件名或者目录   -- 多个设置用逗号隔开,example: chmod u+rx,g-x,o+rw,a+r aaa.php

    chmod -R 777 文件名或者目录 递归修改权限



    rwx权限在文件和目录的区别

    文件--r: 查看文件内容,w:修改文件内容,x:执行文件
    目录--r: 列出目录的内容，查看和复制目录文件,w:在目录中创建和删除文件,x进入目录的权限

  - chown [用户名] [文件名或者目录] 改变文件或者目录的所有者

  - chgrp [用户组] [文件名或者目录] 改变文件或者目录的所属组

  - umask -S 修改默认新建时分配的权限(文件比较特殊默认新建都没有x权限)

* 文件搜素命令
  
  - find  文件搜索
    
    find [搜索范围] [匹配条件]
    
    - example:
      
      * 匹配0个以上字符
      ? 匹配单个字符
      $ 结束
      ```
      -name 根据文件名查找
      -iname 根据文件名查找，不区分大小写
      -size  根据文件大小查找
      -user  根据所有者查找
      -group 根据所属组查找
      -amin  根据访问时间改变查找
      -cmin  根据文件属性改变查找
      -mmin  根据文件内容改变查找
      -a 两个条件同时满足
      -o 两个条件满足其中一个
      -type 根据文件类型查找(f文件 d目录 l软链接文件)
      -inum 根据i节点查找
      -exec/-ok [命令] {} \; 对查找的结果进行操作(-ok会询问)
      ```
      
      ```find /etc -name *init*```
      
      ```find /etc -name *init???```
      
      ```find /etc -size +204800```  /etc目录搜索大于100M的文件
      
      linux里1个数据块是512字节，0.5k,+大于,-小于，不写是等于
      
      ```find /home -user /develop```
      
      ```find /home -cmin -5```  查找5分钟内被修改过属性的文件
      
      +大于, -小于
      
      ```find /etc -size +163840 -a -204800``` 查找/etc目录里大于80M并且小于100M的文件
      
      ```find /etc -iname init* -a -type d```  
      
      ```find /etc -iname intt* -a type f -exec ls -l {} \;
      
* 其他文件搜索命令
  
  - locate 在资料库中查找(资料库会自动定期更新，但是新建的文件短时间内不会被收录无法搜索)
  
    - locate [文件名]
    - locate locate 可以查看资料库
    - updatedb 手动更新资料库(tmp等文件下是不是被收录)
    - locate -i [文件名]   不区分大小写查找文件
    
  - which 搜索命令所在的目录及别名信息
  
    example: which ls
    
    别名：例如cp,rm等都是有别名,rm=rm -i 本身不询问,别名是询问

  - whereis 搜索命令所在的目录以及帮助文档所在的路径
  
  - grep 在文件内容内查找关键词对应的行
  
    ```grep -i muliuser /etc/inittab``` 不区分大小写查找
    
    ```grep -v ^# /etc/inittab``` 去掉行首以#开头的行,去注释非常方便
    
* 帮助命令
  
  - man 原意manual, 1是命令帮助，5是配置文件的帮助，优先显示命令的帮助
  
    查看配置文件或者命令的帮助信息,跟more文本操作一样
    
    ```man ls```
    
    ```man services```
    
    ```man 5 passwd```  查看passwd配置文件的帮助
    
* 用户管理命令

  - useradd [用户名] 添加用户名
  - passwd [用户名]  为用户设置密码
  - who   查看登录用户的信息
    
    - 登录用户名  登录终端(tty:本地终端,pts远程终端) 登录时间  登录的主机的ip地址,没写就是本机登录
  
  - w  查看登录用户的详细信息(含有负载信息,idle:用户登录后的空闲时间,pcpu用户登录后执行操作占用cpu的时间,)
  
    - uptime 查看linux服务器运行时间
    
* 压缩解压命令

  - 常见的压缩格式：.gz,.zip,.rar
  
    - gzip [文件名] 压缩成.gz格式   --- gzip只能压缩文件,不能压缩目录，并且压缩完源文件就没有了
    - gunzip [文件名] 解压缩.gz文件
    
    - tar [压缩后的文件名] [需要压缩的文件或者目录]
    
      -c 打包(把多个文件或者目录打包成一个文件)
      
      -v 显示详细信息
      
      -f 指定文件名
      
      -z 打包同时压缩
      
      -x 解包
      
      example:
      
      ```tar -zcf etc.tar.gz /etc```  把etc目录打包压缩成etc.tar.gz
      
      ```tar -zxf etc.tar.gz```   把etc.tar.gz解压缩
      
    - zip(在windows和linux下均支持)
    
      - zip [压缩后的文件名] [需要压缩的文件]
      - zip -r [压缩后的文件名] [需要压缩的文件或者目录]
      
    - unzip
    
      - unzip [解压缩的文件]
      
* 网络命令

  - write [用户名]  给在线用户发送信息,ctrl+D文本输入结束
  
  - wall [message] 给所有用户发送信息
  
  - ping  [ip地址]  测试网络是否可以连通
  
    -c [次数] 指定发送次数
    
  - ifconfig 查看当前的网络状态
  
    eth0 表示本地的真实网卡
    
    lo 回环地址，127.0.0.1永远都能连通,没网没卡都可以
    
    网络类型：以太网    mac地址/网卡的硬件地址
  
    计算机当前的ip地址   当前网络的广播地址
    
    设置网卡ip地址： ifconfig eth0 192.168.8.250
    
  - mail [用户名] 查看发送邮件
  
  - last 统计计算机所以用户的登陆信息和计算机的重启信息
  
  - lastlog
  
    lastlog -u [uid] 查看用户登录信息
    
  - traceroute 显示数据包到主机间的路径 ---这个命令ubuntu有时需要下载安装包才可以
  
  - netstat [选项] 显示网络相关信息
  
    ```
    -t  TCP协议(传输协议之一,三次握手建立连接,面向连接,及时稳定,比如http)
    -u  UDP协议(更快，但是不安全稳定)
    -l  监听
    -r  路由
    -n  显示ip地址和端口号
    ```
    
    example：
    ```
    netstat -tlun  查看本机监听的端口
    netstat -an    查看本机所有的网络连接
    netstat -rn    查看本机路由表,网关
    ```
  
  - setup       ---redhat系特有的设置网络的工具
    
  - mount   挂载命令
    
    ```
    mount -t iso9600 /dev/sr0  /mnt/cdrom/
           文件系统   设备文件名  挂载点
    ```
  
  -umount 卸载命令
  
   ```
    umount /dev/sr0
   ```
   
* 关机重启命令 ----真实服务器应该关闭所有服务,尽量使用shutdown重启,其他的不推荐

  - shutdown [选项] [时间]
    
    -c 取消前一个关机命令
    
    -h 关机
    
    -r 重启
    
  - halt 关机
  - poweroff 关机
  - init 0 关机
  - reboot 重启
  - init 6 重启
  
  ```
  init 七个系统运行级别
  0 关机 1单用户 2不完全多用户,不含NFS服务(网络文件系统,实现两个linux系统之间文件共享) 3完全多用户 4未分配 5图形界面 6重启 
  cat /etc/inittab 修改系统的默认运行级别
  runlevel 查看系统运行级别
  ```
  
  - logout 退出登录    --- 不用时必须要使用
  
> ### 软件包分类

* 源码包(c语言等写的包)

  -脚本安装包
   
* 二进制包(RPM包、系统默认包)

  - 源代码编译生成二进制包,不能再被查看源代码,省略了编译过程
  
* 包全名与包名

  - 操作的包是没有安装的软件包时，使用包全名，而且要注意路径
  - 操作已经安装的软件名时，使用包名，是搜索/var/lib/rpm/中的数据库
  
* RPM包安装

  - rpm -ivh 包全名
  
    选项
    ```
     -i 安装
     -v 显示详细信息
     -h 显示进度
     --nodeps 不检验依赖性
    ```
    
* RPM包升级

  - rmp -Uvh 包全名
  
* RPM包卸载

  - rpm -e 包名
  
* 查询RPM包是否安装

  - rpm -q 包名
  - rpm -qa 查看所有已安装的rpm包
  - rpm -qi 包名 查看rpm包详细信息

* 查看系统文件属于哪个rpm包

  - rpm -qf 系统文件名
  
* 查看已安装的rpm包依赖性

  - rpm -qR 包名
  
* 查看未安装的rpm包依赖性

  - rpm -qp 包全名
  
* RPM包的检验

  - rpm -V 包名
  
* RPM包`默认`安装位置

  ```
   /etc/           配置文件安装目录
   /usr/bin/       可执行的命令安装目录
   /usr/lib/       程序可使用的函数库保存的位置
   /usr/share/doc  基本的软件使用手册保存的位置
   /usr/share/man  帮组文件保存的位置
  ```
  
* RPM包安装的服务既可以使用绝对路径来管理，也可以使用系统服务命令(前提是默认路径安装)，如redhat系启动apache服务`service httpd start`,源码安装的可以使用绝对路径来管理
  
* 源码包安装

  - 安装前的准备
  
    - 安装C语言编辑器gcc
    - 下载源码包(一般是C语言写的)
    
  - 安装时的注意事项
  
    - 源代码应该保存的位置（推荐的位置，如果想存其他地方也是随便了，只是不好管理)
      
      `/usr/local/src`
      
    - 软件应该安装的位置
    
      `/usr/local`
      
    - 如何确定安装过程报错
    
      - 安装过程停止
      - 出现error、waring、no等提示
      
    - 编译与安装步骤
    
      - 进入解压缩后的包目录
      
        example: ```cd /usr/local/src/httpd-2.2.9```
        
        进入后可以看到基本上都会有`INSTALL`和`README`，一个是安装说明,一个是使用说明,不清楚源代码包的时候可以查看它们来了解
        
      - ./configure  软件配置与检查
      
        - 定义需要的功能选项，其中配置安装路径是必须的`-- prefix=安装路径`
        - 检查系统环境是否符合安装要求
        - 把定义好的功能选项和检查系统环境的信息写入Makefile文件,用于后续的编译
        
      - make    编译(将源码翻译成机器语言)
      
        - 直到这一步时我们仍然尚未对安装目录和源码位置外的其他位置写入任何文件，此时编译错误或者不想安装，可以使用`make clean`清除编译产生的临时文件
      
      - make install 编译安装(此时才真正向安装位置写入文件)
      
* 源码包启动
      
  - 查看`INSTALL`文件查看启动命令
       
* 源码包的卸载

  - 不需要卸载命令,直接删除安装目录即可，不会产生任何遗留的垃圾文件
 
 
> ### 用户和用户组管理
  
* 用户的家目录

  - 普通用户：/home/用户名,所有者和所属组都是该用户，权限700
  
  - 超级用户：/root，所有者和所属组都是root，权限550
    
    将普通用户变成超级用户，只需把uid改为0，但是家目录不变
    
* 用户的邮箱

  - linux中只是用的邮箱客户端，并没有服务器，不同用户之间通过内存传送信息，如果需要向外部发，需要调取外部邮箱服务器
  
  - /var/spool/mail/用户名
  
* 用户模板目录(新建用户时在用户家目录自动生成的相关的文件)

  - /etc/skel
  
* 用户管理命令

  - 添加新用户
  
    ```useradd [选项] 用户名```
    - 具体修改的配置文件和生成的目录、文件如下
    
      ```
      /etc/password
      /etc/shadow
      /etc/group
      /etc/gshadow
      /home/用户名
      /var/spool/mail/用户名
      ```
    - 参数
    
      ```
      -u UID         手工指定用户uid
      -d 家目录       手工指定用户的家目录
      -g 组名         手工指定用户的用户组
      -G 组名         手工指定用户的附属组
      -s shell       手工指定用的shell，默认是bash shell,在/bin/bash
      ```
    - 用户默认值的配置文件
    
      `/etc/default/useradd`
      
      `/etc/login.defs`
  
  - 修改用户密码
    
    - passwd 用户名
    
  - 修改用户信息
  
    - usermod [选项] 用户名
  
  - 修改用户密码状态
  
    ```chage -d 0 用户名```        这样系统就认为用户密码从来没有修改过，在用户登录时强制用户重设密码
    
  - 删除用户命令
  
    - ```userdel -r 用户名```  删除用户并且连着家目录一起删除
    
  - 查看用户ID
  
    `id 用户名`
    
  - 切换用户身份
  
    - su [选项] 用户名
    
      - `-`:选项只使用-则是连带着用户环境变量也一起，不建议省略这个选项，否则环境变量仍然没有更改,`env` 可以查看当前的用户变量
      - '-'：不切换用户身份，只是借用一次身份来执行mingl
      
        example：`su - root -c "useradd user1"` 
        
  - 添加用户组 `groupadd 用户组名`
  
    - -g GID     手动指定组ID
    
  - 修改用户组  `groupmod [选项] 用户组`     ps:不建议使用修改
  
    - -g GID    修改组ID
    - -n 新组名  修改组名
    
      example: `groupmod -n group1 group2`  将group2修改成group1
      
  - 删除用户组   `groupdel 用户组`        ps：初始组和初始用户是依存的，如果用户组有初始用户则无法删除，附加组可以删除不影响
  
  - 把用户添加到组里 `gpasswd -a 用户名 用户组`
  
  - 把用户从组里删除  `gpasswd -a 用户名 用户组`
  
> ### 权限管理

* ACL权限(因为文件和目录只能有一个所属用户和所属组,所以不能完全满足要求)

  - 查看分区ACL权限是否开启
  
    `dumpe2fs -h 分区mul`  在default mount options选项中查看是否支持ACL
    
    `df -h` 查看分区使用情况
    
  - 没有开启时临时开启ACL权限,重启会失效  `mount -o remount,acl 分区`
  - 永久开启ACL权限,需要修改/etc/fstab文件    ps：不建议修改这个文件，一旦写错，系统开机加载就会崩溃起不来
  
    - 这个文件是开机系统自动挂载的文件
    
      ```
      / 根分区
      /boot   boot分区
      /home   home分区
      swap   交换分区

      ```
* 查看和设定ACL权限

  - `getfacl 文件名`           查看ACL权限
  - `setfacl [选项] 文件名`     设置ACL权限
  - example:
  ```
  useradd liming
  groupadd tgroup
  groupadd group1
  mkdir /project
  chown root:tgroup /project
  chmod 770 /project
  setfacl -m u:liming:rx /project
  setfacl -m g:group1:rx /project
  ```

* 最大有效权限和删除ACL权限

  - mask 最大有效权限，实际权限为赋予的权限和最大有效权限相与的结果
    - `setfacl -m m:rx /project`  设置mask权限，只影响ACL权限，正常的ugo权限不影响
  - 删除ACL权限
    - 删除指定用户和用户组权限
    
      `setfacl -x u:liming:rx /project`
      `setfacl -x g:group1:rx /project`
      
    - 删除文件的所有ACL权限
    
      `setfacl -b /project`
      
* 默认的ACL权限和递归的ACL权限    ps：只能赋予给目录，虽然给文件也不会报错但不会起作用

  - -R 递归目录设置
    `setfacl -m u:liming:rx /project`
  - 默认的ACL权限指的是在目录里新建的文件自动设置的权限
    `setfacl -m d:u:liming:rx /project`
  
* 文件特殊权限

  - SetUID  赋予文件
  - SetGID  赋予文件或者目录
  - Sticky BIT  赋予目录，粘着位的作用是让共享目录时，用户只能修改和删除自己建的，不能删改别人的
  
  `chmod 4775 /project`
  `chmod u+s /project`
  `4代表SUID,2代表SGID,1代表sticky BIT
   必须有执行权限才能让赋予的特殊权限起作用，必须给可执行程序或者二进制文件赋予，作用是让用户在执行文件时短时间获得属主身份，比如passwd命令
  `
  `系统根目录或关键目录应该严格控制写权限，文件特殊权限不能轻易赋予，是非常不安全的权限`
  
* 文件系统属性权限 change attribute on a linix file system    ps:作用是防止连带root用户在内的用户的误操作

  - `chattr [+-=][选项] 文件名或者目录`
  
    - 选项
     
     `i`: 
       
       - 如果对文件设置i属性，那么文件将被锁住，只有读权限，不能删除和修改，也不能修改文件属性，最重要的是连root用户也会被限制。
       - 如果对目录设置i属性，那么目录下可以修改文件属性和数据，但不能新建和删除文件
     
     `a`:
     
       - 如果对文件设置a属性，那么文件里的原数据将被锁住，只能新增数据，不能删改原来数据
       - 如果对目录设置a属性，那么只能新建和修改文件，不能删除文件
       
  - `lsattr [选项] 文件名`
  
    - -d 只显示目录属性，显示目录里文件的属性，和ls命令类似
    - -a 显示所有文件和目录
    
    
     
    
      
      
          
      

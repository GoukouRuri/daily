> ### 数据库设计的步骤

> ### 数据库设计前需求分析的重要性

  - 了解所要存储的数据的特点和属性(有哪些属性,可以唯一标识实体的属性有哪些)
  - 了解所要存储的数据的存储特点(不重要的大数据日志还是重要的核心,增长量如何)
  - 了解所要存储的数据的生命周期(永久还是短期,是否可以定时清理或者归档)
  - 实体和实体之间的关系(一对一,一对多,多对多)
  
> ### ER图描述数据库逻辑关系

> ### 设计范式
  - 第一范式:设计成二维表
  - 第二范式:第一范式基础上,复合关键字的表不能有部分函数依赖关系(多个字段才能标识一个实体,且关键字段与其他字段存在部分函数依赖关系,会导致插入更新删除异常以及冗余数据)
  - 第三范式:第二范式基础上,不能有非关键字段对候选关键字段存在部分函数依赖关系(例如商品里的分类字段和分类描述字段) 
  - 对第三范式的扩展(BC范式):第三范式基础上,复合关键字表中,不能有任何字段对候选关键字段存在传递函数依赖关键（也就是说关键字和关键字直接不能有依赖关系）
  
> ### 物理设计
          
  - 选择合适的数据库管理系统
  - 定义数据库、表、字段的命名规范
  - 选择合适的字段类型
  - 为了提高读取速度,有的可能会出现反范式设计,加入冗余字段
  
> ### Mysql的存储引擎

  - MYISAM:不支持事务,读取速度特别快,表锁,不支持行锁,但是不能使用频繁的插入和更新 
  - InnoDB:支持事务,表级锁、行级锁,忌用场景少
  
> ### Mysql的库、表、字段命名规范

  - 可读性
  - 表意性
  - 长名性
  
> ### Mysql的字段类型选择

  - 选择原则
  
    - tinyint   1字节
    - smallint  2字节
    - int       4字节
    - bigint    8字节
    - date      3字节
    - datetime  8字节
    - timestamp 4字节
    - char      1-255字节
    - varchar   1-255字节
  
  - 对数据进行查询、排序、联表操作时整型类型比字符串类型更快
  - 整型类型占用更少的页,列长度越低,页越少,提升IO效率,而IO是数据库的最大瓶颈
  - char和varchar的选择(字符型选择)
  
    - 列存储的数据差不多一致,适合char(如身份证号、手机号等)
    - 列中数据最大长度小于50个字节(utf8大概3字节一个字符),也适合char
    
  - decimal和float的选择(浮点型选择)
  
    - decimal用于存储精确数据,float存储的是非精确数据
    - float的存储空间要比decimal小,所有非精确的可以float
  - int和datetime的选择(日期类型的选择)
  
    - int占用小,速度快,但是使用不方便,需要函数转化,最大只能到2038年
    - 单独存时间粒度,可以用year,month等

> ### Mysql的主键如何选择

  - 主键分为业务主键(标识业务数据)和数据库主键(优化数据库存储,innodo是按主键顺序逻辑进行存储的) 
  - 主键字段类型所占空间尽量小
  
> ### Mysql的外键如何选择

  - 高并发环境避免使用外键约束,因为每次插入都会去检查外键约束
  - 虽然不建议用外键约束保证数据一致性,但是可以在外键上建立索引
  
> ### 避免使用触发器

  - 会降低导入效率
  - 数据异常
  - 业务逻辑复杂了
  
> ### 严禁预留字段

> ### 反范式化表设计(用空间换时间)

  - 避免过多联表
  
    - 例如订单表、商品表、订单商品关联表、用户表生成订单详情汇总,可以订单表加入计算好的订单总额、用户表的姓名、电话、地址, 订单商品关联表加入商品的名称和商品的过期时间
    
> ### 数据库的维护和优化

  - 维护数据字典
  
    - 对字段进行备注
  
  - 维护索引
  
    - 出现在where、order by、group by从句中的列
    - 索引中不要出现太长的数据类型
    - 索引太多会严重影响写的效率,读的效率也会因为sql优化器导致读也会变差(sql优化器在选择多个索引时需要时间)
    - 定期维护索引碎片的维护
    
      - 查询索引页碎片:
        `SHOW TABLE STATUS LIKE '表名'; //当Data_free 列值大于0时表示有碎片(只要删除过数据就会产生,前提是有建立索引)`
      - 优化表:
        `OPTIMIZE TABLE 表名;`
    - 在sql语句中不要使用强制索引关键字
  
  - duration time and fetch time
  
    - duration time:sql语句需要执行的时间.在优化sql性能时,应尽量减少它.
    - fetch time:数据传输时间,这与查询执行无关.我不会把它视为sql查询调试/优化选项,因为取时间取决于网络连接,这本身并没有任何关系与查询优化.如果获取时间是瓶颈,那么更有可能存在一些网络问题.
  
  - 关于QC是否需要开启(msyql的查询缓存)http://imysql.com/2014/09/05/mysql-faq-why-close-query-cache.shtml
  
    - `SHOW VARIABLES LIKE 'query_cache_type';` 如果为off则是关闭,on为已开启
    - QC严格要求2次SQL请求要完全一样,包括SQL语句,连接的数据库、协议版本、字符集等因素都会影响,最为重要的是,在MySQL里QC是由一个全局锁在控制,每次更新QC的内存块都需要进行锁定.如果线上环境中99%以上都是只读,很少有更新,再考虑开启QC吧,否则,就别开了.
    - 关闭的方式
    
      1. 同时设置选项 query_cache_type = 0 和 query_cache_size = 0;
      2. 如果用源码编译MySQL的话,编译时增加参数 --without-query-cache 即可;
    
  - 维护表结构
  
    - mysql5.6以后支持在线更新表结构,不会锁表影响线上业务
    - 及时更新数据字典
    - 控制表的宽度和大小
    
  - 数据库中适合的操作
   
    - 批量操作和逐条操作
    - 避免使用select *
    - 控制使用自定义函数,因为使用函数会导致索引失效
    - 不要使用数据库全文索引
  
  - 对表的水平拆分和垂直拆分
  
    - 垂直拆分
    
      对大宽表的列进行拆分,把大字段加到附加表中
      
    - 水平拆分
    
      参考来源[http://fanfusuzi.blog.51cto.com/9978141/1674267]
    
      

  
> ### 简单过滤

```php
<?php
/*
函数名称：inject_check()
函数作用：检测提交的值是不是含有SQL注射的字符，防止注入，保护服务器安全
参　　数：$sql_str: 提交的变量
返 回 值：返回检测结果，ture or false
*/
function inject_check($sql_str) {
    return preg_match('/select|insert|update|delete|drop|table|file|xml|ini|\\\|\/|\'|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile/i', $sql_str);    // 进行过滤
}

function FilterFormFields($string, $ext = false, $reserved = false) {
    $result = false;
    $var = filter_keyword($string); // 过滤sql与php文件操作的关键字
    if (!empty($var)) {
        if (!get_magic_quotes_gpc()) {    // 判断magic_quotes_gpc是否为打开
            $var = addslashes($string);    // 进行magic_quotes_gpc没有打开的情况对提交数据的过滤
        }
        if ($ext) {
            $var = str_replace("_", "\_", $var);    // 把 '_'替换掉
        }
        $var = str_replace("%", "\%", $var);    // 把 '%'替换掉
        $var = nl2br($var);                   // 回车符转换
        if ($reserved) {
            $var = htmlspecialchars($var);    // 转义html,js, xml, xtml等标签
        } else {
            $var = strip_tags($var);          // 过滤html,js, xml, xtml等标签
        }

        $result = $var;
    }
    return $result;
}

function filter_keyword($string) {
    $keyword = 'select|insert|update|delete|\'|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile';
    $arr = explode('|', $keyword);
    $result = str_ireplace($arr, '', $string);
    return $result;
}
?>

```

> ### 过滤工具类

```php
<?php

class RequestUtils {
    public static function strFilter(){
        $numArgs = func_num_args();
        
        if(!$numArgs) return;
        
        //get argument list
        $argList = func_get_args();
        
        foreach ($argList as &$argument) {
            $argument = self::fliter_script($argument);
            $argument = self::fliter_html($argument);
            $argument = self::fliter_sql($argument);
            $argument = self::fliter_str($argument);
            $argument = self::filter_phptag($argument);
        }
        
        return $argList;
    }
    
    
    /**
     * 
     *  @description   过滤javascript,css,iframes,object等不安全参数 过滤级别高
     *  @param         string $value 需要过滤的值
     *  @return        string
     */
    public static function fliter_script($value) {
        $value = preg_replace("/(javascript:)?on(click|load|key|mouse|error|abort|move|unload|change|dblclick|move|reset|resize|submit)/i","&111n\\2",$value);
        $value = preg_replace("/(.*?)<\/script>/si","",$value);
        $value = preg_replace("/(.*?)<\/iframe>/si","",$value);
        $value = preg_replace ("//iesU", '', $value);
        return $value;
    }
    
    
    /**
     * 
     *  @description   过滤HTML标签
     *  @param         string $value 需要过滤的值
     *  @return        string
     */
    public static function fliter_html($value) {
        if (function_exists('htmlspecialchars')) 
            return htmlspecialchars($value);
        return str_replace(
            array("&", '"', "'", "<", ">"), 
            array("&", "\"", "'", "<", ">"), 
            $value
        );
    }
    
    
    /**
     * 
     *   @description    对进入的数据加下划线 防止SQL注入
     *   @param          string $value 需要过滤的值
     *   @return         string
     */
    function fliter_sql($value) {
        $sql = array("select", 'insert', "update", "delete", "\'", "\/\*","\.\.\/", "\.\/", "union", "into", "load_file", "outfile");
        $sql_re = array("","","","","","","","","","","","");
        return str_replace($sql, $sql_re, $value);
    }
    
    
    /**
     * 
     *   @description      通用数据过滤
     *   @param            string $value 需要过滤的值
     *   @return           string
     */
    function fliter_escape($value) {
        if (is_array($value)) {
          foreach ($value as $k => $v) {
           $value[$k] = self::fliter_str($v);
          }
        } else {
          $value = self::fliter_str($value);
        }
        return $value;
    }
    
    
    /**
     * 
     *   @description       字符串过滤 过滤特殊有危害字符
     *   @param             string $value 需要过滤的值
     *   @return            string
     */
    function fliter_str($value) {
        $badstr = array("\0", "%00", "\r", '&', ' ', '"', "'", "<", ">", "   ", "%3C", "%3E");
        $newstr = array('', '', '', '&', ' ', '"', ''
        ', "<", ">", "   ", "<", ">");
        $value  = str_replace($badstr, $newstr, $value);
        $value  = preg_replace('/&((#
        #
        #
        #(\d{3,5}|x[a-fA-F0-9]{4}));)/', '&\\1', $value);
        return $value;
    }
    
    
    /**
     * 
     *   @description      私有路径安全转化
     *   @param            string $value 需要过滤的值
     *   @return           string
     */
    function filter_dir($fileName) {
        $tmpname = strtolower($fileName);
        $temp = array(':/',"\0", "..");
        if (str_replace($temp, '', $tmpname) !== $tmpname) {
          return false;
        }
        return $fileName;
    }
    
    
    /**
     * 
     *   @description      过滤目录
     *   @param            string $value 需要过滤的值
     *   @return           string
     */
    public function filter_path($path) {
        $path = str_replace(array("'",'#','=','`','$','%','&',';'), '', $path);
        return rtrim(preg_replace('/(\/){2,}|(\\\){1,}/', '/', $path), '/');
    }
    
    
    /**
     * 
     *   @description    过滤php标签
     *   @param          string $value 需要过滤的值
     *   @return         string
     */
    public function filter_phptag($string) {
        return str_replace(array(''), array('<?', '?>'), $string);
    }
    
    
    /**
     * 
     *   @description    使用addslashes函数转义sql,addslashes函数为了不重复转义，一般会需要判断下服务器是否开启了自动转义，然后再进行转义
     *   @param          string $value 需要转义的值
     *   @return         string
     */
    public function add_slashes($string, $force = 0)
    {
        if(!get_magic_quotes_gpc() || $force)
        {
            if(is_array($string))
            {
                foreach($string as $key => $val)
                {
                    $string[$key] = daddslashes($val, $force);
                }
            }
            else
            {
                $string = addslashes($string);
            }
        }
     
        return $string;
    }
    
    
    /**
     * 
     *   @description    为了让所有的sql关键词都安全存储
     *   @param          string $value 需要转义的值
     *   @return         string
     */
    public function sql_encode($str)
    {
        if(empty($str)) return "";
        $str=trim($str);
    
        $str=str_replace("_","\_",$str);
        $str=str_replace("%","\%",$str);
        $str=str_replace(chr(39),"&#39;",$str);
        $str=str_replace("'","''",$str);
        $str=str_replace("select","sel&#101;ct",$str);
        $str=str_replace("join","jo&#105;n",$str);
        $str=str_replace("union","un&#105;on",$str);
        $str=str_replace("where","wh&#101;re",$str);
        $str=str_replace("insert","ins&#101;rt",$str);
        $str=str_replace("delete","del&#101;te",$str);
        $str=str_replace("update","up&#100;ate",$str);
        $str=str_replace("like","lik&#101;",$str);
        $str=str_replace("drop","dro&#112;",$str);
        $str=str_replace("create","cr&#101;ate",$str);
        $str=str_replace("modify","mod&#105;fy",$str);
        $str=str_replace("rename","ren&#097;me",$str);
        $str=str_replace("alter","alt&#101;r",$str);
        $str=str_replace("cast","ca&#115;",$str);
        return $str;
    }
    
    
    /**
     * 
     *   @description    将转义存储的sql转码回来
     *   @param          string $value 需要转码的值
     *   @return         string
     */
    public function sql_decode($str)
    {
        if(empty($str)) return "";
    
        $str=str_replace("&#39;",chr(39),$str);
        $str=str_replace("''","'",$str);
        $str=str_replace("sel&#101;ct","select",$str);
        $str=str_replace("jo&#105;n","join",$str);
        $str=str_replace("un&#105;on","union",$str);
        $str=str_replace("wh&#101;re","where",$str);
        $str=str_replace("ins&#101;rt","insert",$str);
        $str=str_replace("del&#101;te","delete",$str);
        $str=str_replace("up&#100;ate","update",$str);
        $str=str_replace("lik&#101;","like",$str);
        $str=str_replace("dro&#112;","drop",$str);
        $str=str_replace("cr&#101;ate","create",$str);
        $str=str_replace("mod&#105;fy","modify",$str);
        $str=str_replace("ren&#097;me","rename",$str);
        $str=str_replace("alt&#101;r","alter",$str);
        $str=str_replace("ca&#115;","cast",$str);
        return $str;
    }
    
    
    
}
?>
  
```


